<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberCare for Businesses</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- GLOBAL STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7fa; /* Light grey background */
            color: #1f2937; /* Dark gray text */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- LAYOUT --- */
        .main-layout {
            display: flex;
            height: 100vh;
            background-color: #f4f7fa;
        }

        .sidebar {
            width: 256px; /* 16rem */
            flex-shrink: 0;
            background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            overflow-y: auto;
            z-index: 20;
            transition: transform 0.3s ease-in-out;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background-color: #ffffff;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            border-bottom: 1px solid #e5e7eb;
            z-index: 10;
        }

        main {
            flex: 1;
            overflow-x: hidden;
            overflow-y: auto;
            padding: 2rem; /* 32px */
        }

        /* --- NAVIGATION --- */
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* 12px */
            padding: 0.75rem 1rem; /* 12px 16px */
            font-weight: 500;
            color: #4b5563; /* Medium gray */
            transition: all 0.2s ease-in-out;
            border-left: 4px solid transparent;
        }

        .nav-link:hover {
            background-color: #eef2ff; /* Light indigo */
            color: #3730a3; /* Dark indigo */
        }

        .nav-link.active {
            background-color: #eef2ff; /* Light indigo */
            color: #3730a3; /* Dark indigo */
            border-left-color: #4f46e5; /* Main indigo */
            font-weight: 600;
        }

        /* --- PAGE SECTIONS & ANIMATIONS --- */
        .page-section {
            display: none; /* Hidden by default, shown by JS */
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- COMPONENTS --- */
        .feature-card {
            background-color: #ffffff;
            padding: 1.5rem; /* 24px */
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            border-radius: 0.375rem; /* 6px */
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .btn-primary {
            background-color: #4f46e5;
            color: #ffffff;
        }

        .btn-primary:hover {
            background-color: #4338ca;
        }

        .btn-secondary {
            background-color: #10b981;
            color: #ffffff;
        }

        .btn-secondary:hover {
            background-color: #059669;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; /* Cool gray 300 */
            border-radius: 0.375rem;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px #c7d2fe;
        }

        .loader {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Language Switcher */
        .lang-btn {
            opacity: 0.7;
            transition: all 0.2s;
            font-weight: 500;
            color: #4b5563;
            background: none;
            border: none;
            cursor: pointer;
        }
        .lang-btn.active, .lang-btn:hover {
            opacity: 1;
            transform: scale(1.1);
            font-weight: 700;
            color: #4f46e5;
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(17, 24, 39, 0.75); /* Gray-900 with opacity */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            width: 100%;
            max-width: 42rem; /* 672px */
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal-container {
            transform: scale(1);
        }

        /* --- SPECIFIC PAGE STYLES --- */

        /* Reporting Tabs */
        .report-stage-btn {
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .report-stage-btn.active {
            border-color: #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }

        /* Vendor Status & Industry Shield Alerts */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .status-green { background-color: #d1fae5; color: #065f46; }
        .status-yellow { background-color: #fef3c7; color: #92400e; }
        .status-red { background-color: #fee2e2; color: #991b1b; }

        .alert-card {
            background-color: #fffbeb; /* Light yellow */
            border-left: 4px solid #f59e0b; /* Yellow */
            padding: 1rem;
            border-radius: 0.375rem;
        }

        /* Training Card */
        .training-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .training-option:hover {
            background-color: #f3f4f6;
            border-color: #4f46e5;
        }
        .training-option.selected {
            background-color: #eef2ff;
            border-color: #4f46e5;
            font-weight: 600;
        }
        .training-result {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
        }
        .training-result.correct { background-color: #d1fae5; color: #065f46; }
        .training-result.wrong { background-color: #fee2e2; color: #991b1b; }

        .hidden {
            display: none;
        }
        
        /* --- MOBILE RESPONSIVE STYLES --- */
        @media (max-width: 767px) { /* Corresponds to md: breakpoint in Tailwind */
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                transform: translateX(-100%);
                z-index: 40; /* Ensure sidebar is on top */
            }

            .sidebar.is-open {
                transform: translateX(0);
            }
            
            .header {
                position: relative;
                z-index: 30;
            }

            .main-content {
                width: 100%;
            }
            
            main {
                padding: 1rem; /* Reduced padding on mobile */
            }

            /* Overlay for when the menu is open */
            .sidebar-overlay {
                position: fixed;
                inset: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 39; /* Below sidebar, above content */
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            }

            .sidebar-overlay.is-open {
                opacity: 1;
                visibility: visible;
            }
        }
    </style>
</head>
<body>
    
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="main-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="flex items-center justify-center gap-3 p-4 border-b">
                <span class="bg-indigo-600 text-white p-3 rounded-lg"><i class="fa-solid fa-shield-halved fa-lg"></i></span>
                <h1 class="text-2xl font-bold text-gray-900">CyberCare</h1>
            </div>
            <nav class="mt-4">
                <a href="#dashboard" class="nav-link" data-nav="dashboard"><i class="fa-solid fa-chart-pie w-6 text-center"></i><span data-translate="nav_dashboard"></span></a>
                <a href="#checklist" class="nav-link" data-nav="checklist"><i class="fa-solid fa-list-check w-6 text-center"></i><span data-translate="nav_checklist"></span></a>
                <a href="#reporting" class="nav-link" data-nav="reporting"><i class="fa-solid fa-bullhorn w-6 text-center"></i><span data-translate="nav_reporting"></span></a>
                
                <p class="px-4 mt-4 mb-2 text-xs font-semibold text-gray-400 uppercase" data-translate="nav_killer_features"></p>
                <a href="#marketplace" class="nav-link" data-nav="marketplace"><i class="fa-solid fa-store w-6 text-center"></i><span data-translate="nav_marketplace"></span></a>
                <a href="#risk_calculator" class="nav-link" data-nav="risk_calculator"><i class="fa-solid fa-calculator w-6 text-center"></i><span data-translate="nav_risk_calculator"></span></a>
                <a href="#vendor_chain" class="nav-link" data-nav="vendor_chain"><i class="fa-solid fa-link w-6 text-center"></i><span data-translate="nav_vendor_chain"></span></a>
                <a href="#industry_shield" class="nav-link" data-nav="industry_shield"><i class="fa-solid fa-users-viewfinder w-6 text-center"></i><span data-translate="nav_industry_shield"></span></a>
                <a href="#training" class="nav-link" data-nav="training"><i class="fa-solid fa-graduation-cap w-6 text-center"></i><span data-translate="nav_training"></span></a>

                <p class="px-4 mt-4 mb-2 text-xs font-semibold text-gray-400 uppercase" data-translate="nav_proactive_defense"></p>
                <a href="#onboarding" class="nav-link" data-nav="onboarding"><i class="fa-solid fa-user-check w-6 text-center"></i><span data-translate="nav_onboarding"></span></a>
                <a href="#policy_generator" class="nav-link" data-nav="policy_generator"><i class="fa-solid fa-file-alt w-6 text-center"></i><span data-translate="nav_policy_generator"></span></a>
                <a href="#incident_drill" class="nav-link" data-nav="incident_drill"><i class="fa-solid fa-fire-extinguisher w-6 text-center"></i><span data-translate="nav_incident_drill"></span></a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content">
            <header class="header">
                <div class="flex items-center justify-between p-4">
                     <!-- Hamburger Menu Button (Mobile) -->
                    <button id="menu-toggle-btn" class="md:hidden text-gray-700 text-2xl focus:outline-none">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <h2 id="page-title" class="text-xl font-bold text-gray-700 mx-auto md:mx-0"></h2>
                    <div id="lang-switcher" class="flex items-center gap-4">
                        <button class="lang-btn" data-lang="ro">RO</button>
                        <button class="lang-btn" data-lang="ru">RU</button>
                        <button class="lang-btn" data-lang="en">EN</button>
                    </div>
                </div>
            </header>
            <main>
                <!-- Dashboard Page -->
                <section id="dashboard" class="page-section">
                    <h2 class="text-3xl font-bold mb-6" data-translate="dashboard_title"></h2>
                    <div class="feature-card">
                        <p class="text-gray-600 mb-4" data-translate="dashboard_subtitle"></p>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input id="scan-target" type="text" placeholder="exemplu.md" class="input-field flex-grow">
                            <button id="start-scan-btn" class="btn btn-primary w-full sm:w-auto">
                                <i class="fa-solid fa-magnifying-glass"></i><span data-translate="dashboard_scan_button"></span>
                            </button>
                        </div>
                    </div>
                    <div id="loader-container" class="mt-8 hidden text-center"><div class="loader inline-block"></div><p class="mt-2 text-gray-600" data-translate="scan_in_progress"></p></div>
                    <div id="scan-results-container" class="mt-8"></div>
                </section>

                <!-- Checklist Page -->
                <section id="checklist" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="checklist_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="checklist_subtitle"></p>
                    <div class="feature-card">
                        <div class="mb-6"><h4 class="font-semibold mb-2" data-translate="checklist_progress"></h4>
                            <div class="w-full bg-gray-200 rounded-full h-4"><div id="checklist-progress-bar" class="bg-indigo-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                            <p id="checklist-progress-text" class="text-center font-semibold mt-1">0%</p>
                        </div>
                        <form id="compliance-form" class="space-y-6"></form>
                    </div>
                </section>

                <!-- Reporting Page -->
                <section id="reporting" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="reporting_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="reporting_subtitle"></p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 feature-card">
                            <div class="border-b border-gray-200 mb-6"><nav id="report-stages" class="flex -mb-px space-x-6"></nav></div>
                            <form id="incident-report-form" class="space-y-4"></form>
                        </div>
                        <div class="feature-card">
                            <h3 class="text-xl font-bold mb-3 flex items-center gap-2"><i class="fa-solid fa-robot text-indigo-500"></i><span data-translate="smart_reporter_title"></span></h3>
                            <p class="text-gray-600 mb-4" data-translate="smart_reporter_desc"></p>
                            <textarea id="ai-helper-input" rows="4" class="input-field" data-translate-placeholder="incident_placeholder"></textarea>
                            <button id="ai-helper-btn" class="mt-3 w-full btn btn-primary"><span data-translate="get_ai_help"></span></button>
                            <div id="ai-suggestion-box" class="mt-4 hidden"><h4 class="font-semibold" data-translate="ai_suggestion"></h4><p class="text-sm bg-gray-100 p-3 rounded-md mt-2"></p></div>
                        </div>
                    </div>
                </section>
                
                <!-- Marketplace Page -->
                <section id="marketplace" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="marketplace_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="marketplace_subtitle"></p>
                    <div id="marketplace-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </section>

                <!-- Risk Calculator Page -->
                <section id="risk_calculator" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="risk_calculator_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="risk_calculator_subtitle"></p>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="feature-card">
                            <form id="risk-form" class="space-y-4">
                                <div><label for="industry-select" class="font-medium" data-translate="industry"></label><select id="industry-select" class="input-field mt-1"></select></div>
                                <div><label for="employees-input" class="font-medium" data-translate="employees"></label><input type="number" id="employees-input" class="input-field mt-1" value="25"></div>
                                <div><label for="turnover-input" class="font-medium" data-translate="turnover"></label><input type="number" id="turnover-input" class="input-field mt-1" value="5000000"></div>
                                <button type="submit" class="btn btn-primary w-full"><span data-translate="calculate_risk"></span></button>
                            </form>
                        </div>
                        <div id="risk-results-container" class="feature-card flex flex-col justify-center items-center text-center hidden">
                             <div id="risk-results"></div>
                        </div>
                    </div>
                </section>

                <!-- Vendor Chain Page -->
                <section id="vendor_chain" class="page-section">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
                        <div><h2 class="text-3xl font-bold" data-translate="vendor_chain_title"></h2><p class="text-gray-600" data-translate="vendor_chain_subtitle"></p></div>
                        <button id="invite-vendor-btn" class="btn btn-primary"><i class="fa-solid fa-plus"></i> <span data-translate="invite_vendor"></span></button>
                    </div>
                    <div class="feature-card">
                        <table class="w-full">
                            <thead><tr class="border-b"><th class="text-left p-3" data-translate="vendor_name"></th><th class="text-left p-3" data-translate="vendor_status"></th></tr></thead>
                            <tbody id="vendor-list"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Industry Shield Page -->
                <section id="industry_shield" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="industry_shield_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="industry_subtitle"></p>
                    <div id="shield-alerts-container" class="space-y-4"></div>
                </section>

                <!-- Training Page -->
                <section id="training" class="page-section">
                     <h2 class="text-3xl font-bold mb-2" data-translate="training_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="training_subtitle"></p>
                    <div id="training-card" class="feature-card max-w-2xl mx-auto"></div>
                </section>
                
                <!-- Onboarding Page -->
                <section id="onboarding" class="page-section">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
                        <div><h2 class="text-3xl font-bold" data-translate="onboarding_title"></h2><p class="text-gray-600" data-translate="onboarding_subtitle"></p></div>
                        <button id="invite-employee-btn" class="btn btn-primary"><i class="fa-solid fa-user-plus"></i> <span data-translate="onboarding_invite"></span></button>
                    </div>
                    <div class="feature-card">
                        <table class="w-full">
                            <thead><tr class="border-b"><th class="text-left p-3" data-translate="onboarding_employee"></th><th class="text-left p-3" data-translate="onboarding_status"></th><th class="text-left p-3" data-translate="onboarding_date"></th></tr></thead>
                            <tbody id="employee-list"></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Policy Generator Page -->
                <section id="policy_generator" class="page-section">
                    <h2 class="text-3xl font-bold mb-2" data-translate="policy_generator_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="policy_generator_subtitle"></p>
                    <div id="policy-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </section>

                <!-- Incident Drill Page -->
                <section id="incident_drill" class="page-section">
                     <h2 class="text-3xl font-bold mb-2" data-translate="incident_drill_title"></h2>
                    <p class="text-gray-600 mb-6" data-translate="incident_drill_subtitle"></p>
                    <div id="drill-container" class="feature-card max-w-3xl mx-auto"></div>
                </section>

            </main>
        </div>
    </div>

    <!-- Modal Template -->
    <div id="modal" class="modal-overlay">
        <div class="modal-container">
            <div class="flex justify-between items-center p-4 border-b"><h3 id="modal-title" class="text-xl font-bold"></h3><button id="modal-close-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
            <div id="modal-content" class="p-6 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Main Application Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- MOCK DATA STORE ---
            const mockData = {
                scanFindings: [
                    { titleKey: 'finding_tls_title', statusOkThreshold: 80, detailsKey: 'finding_tls_details', recommendationKey: 'finding_tls_rec' },
                    { titleKey: 'finding_email_auth_title', statusOkThreshold: 65, detailsKey: 'finding_email_auth_details', recommendationKey: 'finding_email_auth_rec' },
                    { titleKey: 'finding_headers_title', status: 'warn', detailsKey: 'finding_headers_details', recommendationKey: 'finding_headers_rec' },
                ],
                checklist: [
                    { sectionKey: "checklist_section1_title", questions: [{ id: 'q1', textKey: 'checklist_q1_text'}, {id: 'q2', textKey: 'checklist_q2_text'}] },
                    { sectionKey: "checklist_section2_title", questions: [{ id: 'q3', textKey: 'checklist_q3_text'}, { id: 'q4', textKey: 'checklist_q4_text'}] },
                    { sectionKey: "checklist_section3_title", questions: [{ id: 'q5', textKey: 'checklist_q5_text'}] }
                ],
                experts: [
                    { name: 'SecureIT Solutions', specKey: 'spec_web_sec', rating: 4.8 }, { name: 'DataProtect SRL', specKey: 'spec_backup', rating: 4.9 },
                    { name: 'InfraGuard', specKey: 'spec_net_sec', rating: 4.7 }, { name: 'MailFortress', specKey: 'spec_email_sec', rating: 5.0 },
                ],
                industries: [
                    { key: 'industry_retail', name: 'Retail' }, { key: 'industry_it', name: 'IT' }, 
                    { key: 'industry_agri', name: 'Agricultură' }, { key: 'industry_const', name: 'Construcții' }
                ],
                vendors: [
                    { name: 'Contabilitate SRL', status: 'green' }, { name: 'IT Service Grup', status: 'green' },
                    { name: 'Marketing Agency', status: 'yellow' }, { name: 'Courier Service', status: 'red' }
                ],
                alerts: [
                    { titleKey: 'alert1_title', dateKey: 'alert_date_2h' },
                    { titleKey: 'alert2_title', dateKey: 'alert_date_1d' },
                ],
                trainingQuestions: [
                    { questionKey: 'training_q1', optionsKeys: ['training_q1_opt1', 'training_q1_opt2', 'training_q1_opt3'], correct: 1 },
                    { questionKey: 'training_q2', optionsKeys: ['training_q2_opt1', 'training_q2_opt2', 'training_q2_opt3'], correct: 1 },
                ],
                employees: [
                    { name: 'Ion Popescu', status: 'completed', date: '2025-08-15' },
                    { name: 'Maria Ionescu', status: 'pending', date: '-' }
                ],
                policies: [
                    { titleKey: 'policy_pass_title', icon: 'fa-key' },
                    { titleKey: 'policy_net_title', icon: 'fa-wifi' },
                    { titleKey: 'policy_incident_title', icon: 'fa-file-medical' }
                ],
                drillSteps: [
                    { titleKey: 'drill_step1_title', questionKey: 'drill_step1_q', optionsKeys: ['drill_step1_opt1', 'drill_step1_opt2'] },
                    { titleKey: 'drill_step2_title', questionKey: 'drill_step2_q', inputPlaceholderKey: 'drill_step2_placeholder' }
                ]
            };

            // --- DICTIONARIES AND TRANSLATIONS ---
            const translations = {
                ro: {
                    nav_dashboard: "Panou de control", nav_checklist: "Listă Conformitate", nav_reporting: "Raportare Incident", nav_killer_features: "Funcționalități Cheie",
                    nav_marketplace: "Piața Cyber-Help", nav_risk_calculator: "Calculator de Risc", nav_vendor_chain: "Lanț de Încredere", nav_industry_shield: "Scut de Industrie",
                    nav_training: "Cyber-Antrenament", nav_proactive_defense: "Apărare Proactivă", nav_onboarding: "Integrare Angajați", nav_policy_generator: "Generator Politici",
                    nav_incident_drill: "Simulare Incident",
                    dashboard_title: "Panou de control Igienă Cibernetică", dashboard_subtitle: "Introduceți domeniul sau IP-ul pentru a efectua un audit de bază.", dashboard_scan_button: "Pornește Scanarea",
                    scan_results_for: "Rezultate Audit pentru", compliance_score: "Scor de Conformitate", key_findings: "Constatări Cheie", scan_in_progress: "Scanare în desfășurare...",
                    passport_button: "Descarcă Pașaport", passport_title: "Pașaport de Conformitate", passport_desc: "Acesta este un model al raportului PDF care va fi generat.",
                    dynamics_title: "Dinamica Îmbunătățirilor", status_good: "Bun", status_medium: "Mediu", status_weak: "Slab",
                    finding_recommendation: "Recomandare", find_expert_button: "Găsește Expert",
                    finding_tls_title: "Politici TLS/SSL", finding_tls_details: "TLS 1.2 & 1.3 activate. Certificat valid.", finding_tls_rec: "Dezactivați versiunile vechi de TLS (1.0, 1.1).",
                    finding_email_auth_title: "Autentificare E-mail (SPF, DKIM)", finding_email_auth_details: "Înregistrare SPF găsită. Înregistrarea DKIM lipsește.", finding_email_auth_rec: "Configurați DKIM pentru a preveni spoofing-ul.",
                    finding_headers_title: "Antete de Securitate Web", finding_headers_details: "Lipsește Content-Security-Policy.", finding_headers_rec: "Implementați un antet CSP strict.",
                    checklist_title: "Listă de Conformitate (Art. 11)", checklist_subtitle: "Completați acest chestionar pentru a evalua nivelul de conformitate.",
                    checklist_progress: "Progres Conformitate",
                    checklist_section1_title: "Controlul Accesului", checklist_q1_text: 'Este autentificarea multi-factor (MFA) obligatorie pentru conturile administrative?', checklist_q2_text: 'Parolele sunt complexe și se rotesc periodic?',
                    checklist_section2_title: "Backup și Recuperare", checklist_q3_text: 'Există un plan de backup pentru datele critice?', checklist_q4_text: 'A fost efectuat un test de restaurare în ultimele 6 luni?',
                    checklist_section3_title: "Logging și Monitorizare", checklist_q5_text: 'Evenimentele de securitate sunt centralizate și monitorizate?',
                    reporting_title: "Raportare Incident (Art. 12)", reporting_subtitle: "Utilizați acest formular pentru a notifica autoritățile.",
                    initial_report: "Notificare Inițială", update_report: "Actualizare", final_report: "Raport Final",
                    report_details_for: "Detalii pentru", report_submit: "Trimite Raport",
                    smart_reporter_title: "Reporter Inteligent (AI)", smart_reporter_desc: "Descrieți incidentul în cuvinte simple. AI-ul va ajuta.",
                    get_ai_help: "Obține Ajutor AI", ai_suggestion: "Sugestie AI", incident_placeholder: "ex: Site-ul nostru a fost spart...",
                    ai_suggestion_text: "S-a detectat un incident de tip 'Web Defacement'. Se recomandă izolarea serverului și analiza log-urilor.",
                    marketplace_title: "Piața Cyber-Help", marketplace_subtitle: "Găsiți experți locali verificați.", contact_expert: "Contactează Expertul",
                    spec_web_sec: "Securitate Web", spec_backup: "Backup & Recuperare", spec_net_sec: "Securitate Rețea", spec_email_sec: "Securitate Email",
                    risk_calculator_title: "Calculator de Risc", risk_calculator_subtitle: "Transformați riscurile în estimări financiare.",
                    calculate_risk: "Calculează Riscul", potential_loss: "Pierdere Potențială Anuală Estimată", insurance_readiness: "Index de Pregătire pentru Asigurare",
                    industry: "Industrie", employees: "Nr. Angajați", turnover: "Cifra de afaceri (MDL)",
                    industry_retail: "Retail", industry_it: "IT", industry_agri: "Agricultură", industry_const: "Construcții",
                    vendor_chain_title: "Lanțul de Încredere", vendor_chain_subtitle: "Gestionați riscurile provenite de la parteneri.",
                    invite_vendor: "Invită Furnizor", vendor_name: "Nume Furnizor", vendor_status: "Status",
                    status_green: "Conform", status_yellow: "Necesită Atenție", status_red: "Risc Ridicat",
                    industry_shield_title: "Scutul Industriei", industry_subtitle: "Primiți alerte specifice industriei dvs.",
                    recent_alerts: "Alerte Recente", alert1_title: "Atac Phishing nou detectat în sectorul Agricol", alert2_title: "Vulnerabilitate critică în software-ul de contabilitate X",
                    alert_date_2h: "Acum 2 ore", alert_date_1d: "Acum 1 zi",
                    training_title: "Antrenament Cibernetic", training_subtitle: "Testează-ți cunoștințele. Este phishing sau nu?",
                    submit_answer: "Trimite Răspuns", correct_answer: "Corect!", wrong_answer: "Greșit!", next_question: "Următoarea Întrebare",
                    training_q1: "Ați primit un email de la 'banca-moldova@info.com' care vă cere să vă confirmați parola. Ce faceți?",
                    training_q1_opt1: "Introduc parola", training_q1_opt2: "Șterg email-ul și îl raportez", training_q1_opt3: "Sun la bancă să verific",
                    training_q2: "Un pop-up apare și spune 'Ați câștigat un iPhone! Click aici!'. Ce faceți?",
                    training_q2_opt1: "Click pentru a revendica", training_q2_opt2: "Închid fereastra pop-up", training_q2_opt3: "Introduc datele mele",
                    onboarding_title: "Integrarea Angajaților", onboarding_subtitle: "Asigurați-vă că fiecare nou membru primește instrucțiuni de bază.",
                    onboarding_invite: "Invită Angajat", onboarding_employee: "Angajat", onboarding_status: "Status", onboarding_date: "Data finalizării",
                    onboarding_status_completed: "Finalizat", onboarding_status_pending: "În așteptare",
                    policy_generator_title: "Generator de Politici", policy_generator_subtitle: "Creați documente de securitate pentru compania dvs.",
                    policy_generate_button: "Generează", policy_pass_title: "Politica de Parole", policy_net_title: "Politica de Utilizare a Internetului", policy_incident_title: "Plan de Răspuns la Incident",
                    incident_drill_title: "Simulare de Incident", incident_drill_subtitle: "Testați pregătirea echipei dvs. printr-un exercițiu simulat.",
                    incident_drill_start_button: "Începe Simularea", incident_drill_step: "Pasul", incident_drill_finish_button: "Finalizează",
                    incident_drill_results_title: "Rezultatele Simulării",
                    drill_step1_title: "Detecție", drill_step1_q: "Ați primit un email suspect. Ce faceți mai întâi?",
                    drill_step1_opt1: "Izolez mașina și raportez", drill_step1_opt2: "Șterg email-ul",
                    drill_step2_title: "Raportare", drill_step2_q: "Ați izolat problema. Unde raportați incidentul intern?",
                    drill_step2_placeholder: "Numele persoanei/departamentului",
                    drill_continue_button: "Continuă",
                    drill_results_text: "Simulare finalizată. Timp de răspuns: 5 minute. Puncte de îmbunătățit: Clarificarea contactului intern.",
                    drill_rerun_button: "Rulează din nou",
                },
                ru: {
                    nav_dashboard: "Панель управления", nav_checklist: "Чек-лист", nav_reporting: "Сообщить", nav_killer_features: "Ключевые функции",
                    nav_marketplace: "Биржа Cyber-Помощи", nav_risk_calculator: "Калькулятор рисков", nav_vendor_chain: "Цепочка доверия", nav_industry_shield: "Отраслевой щит", nav_training: "Тренировка",
                    nav_proactive_defense: "Проактивная защита", nav_onboarding: "Инструктаж", nav_policy_generator: "Генератор политик", nav_incident_drill: "Симулятор инцидента",
                    dashboard_title: "Панель кибергигиены", dashboard_subtitle: "Введите домен или IP для аудита.", dashboard_scan_button: "Сканировать",
                    scan_results_for: "Результаты для", compliance_score: "Оценка", key_findings: "Ключевые выводы", scan_in_progress: "Сканирование...",
                    passport_button: "Скачать Паспорт", passport_title: "Паспорт Соответствия", passport_desc: "Это макет PDF-отчета.",
                    dynamics_title: "Динамика улучшений", status_good: "Хорошо", status_medium: "Средне", status_weak: "Слабо",
                    finding_recommendation: "Рекомендация", find_expert_button: "Найти эксперта",
                    finding_tls_title: "Политики TLS/SSL", finding_tls_details: "TLS 1.2 и 1.3 активны. Сертификат действителен.", finding_tls_rec: "Отключите устаревшие версии TLS (1.0, 1.1).",
                    finding_email_auth_title: "Аутентификация почты (SPF, DKIM)", finding_email_auth_details: "Найдена SPF-запись. DKIM-запись отсутствует.", finding_email_auth_rec: "Настройте DKIM для предотвращения спуфинга.",
                    finding_headers_title: "Заголовки безопасности", finding_headers_details: "Отсутствует Content-Security-Policy.", finding_headers_rec: "Внедрите строгий заголовок CSP.",
                    checklist_title: "Чек-лист (Ст. 11)", checklist_subtitle: "Заполните опросник для оценки соответствия.", checklist_progress: "Прогресс",
                    checklist_section1_title: "Контроль доступа", checklist_q1_text: 'Обязательна ли многофакторная аутентификация (MFA) для административных учетных записей?', checklist_q2_text: 'Пароли сложные и периодически меняются?',
                    checklist_section2_title: "Резервное копирование и восстановление", checklist_q3_text: 'Существует ли план резервного копирования критически важных данных?', checklist_q4_text: 'Проводился ли тест восстановления за последние 6 месяцев?',
                    checklist_section3_title: "Логирование и мониторинг", checklist_q5_text: 'События безопасности централизованы и отслеживаются?',
                    reporting_title: "Отчет об инциденте (Ст. 12)", reporting_subtitle: "Используйте эту форму для уведомления властей.",
                    initial_report: "Первичное", update_report: "Обновление", final_report: "Финальное",
                    report_details_for: "Детали для", report_submit: "Отправить отчет",
                    smart_reporter_title: "Умный репортер (ИИ)", smart_reporter_desc: "Опишите инцидент своими словами.", get_ai_help: "Помощь ИИ", ai_suggestion: "AI-предложение",
                    incident_placeholder: "пример: Наш сайт взломали...",
                    ai_suggestion_text: "Обнаружен инцидент типа 'Web Defacement'. Рекомендуется изолировать сервер и проанализировать логи.",
                    marketplace_title: "Биржа Cyber-Помощи", marketplace_subtitle: "Найдите местных экспертов.", contact_expert: "Связаться",
                    spec_web_sec: "Веб-безопасность", spec_backup: "Бэкап и восстановление", spec_net_sec: "Сетевая безопасность", spec_email_sec: "Безопасность почты",
                    risk_calculator_title: "Калькулятор рисков", risk_calculator_subtitle: "Преобразуйте риски в финансовые оценки.",
                    calculate_risk: "Рассчитать", potential_loss: "Потенциальный годовой убыток", insurance_readiness: "Готовность к страхованию",
                    industry: "Отрасль", employees: "Кол-во сотрудников", turnover: "Оборот (MDL)",
                    industry_retail: "Торговля", industry_it: "IT", industry_agri: "Сельское хозяйство", industry_const: "Строительство",
                    vendor_chain_title: "Цепочка доверия поставщиков", vendor_chain_subtitle: "Управляйте рисками от партнеров.",
                    invite_vendor: "Пригласить", vendor_name: "Имя поставщика", vendor_status: "Статус",
                    status_green: "Соответствует", status_yellow: "Требует внимания", status_red: "Высокий риск",
                    industry_shield_title: "Отраслевой щит", industry_subtitle: "Получайте оповещения для вашей отрасли.",
                    recent_alerts: "Последние оповещения", alert1_title: "Обнаружена новая фишинг-атака в агросекторе", alert2_title: "Критическая уязвимость в ПО для бухгалтерии X",
                    alert_date_2h: "2 часа назад", alert_date_1d: "1 день назад",
                    training_title: "Еженедельная тренировка", training_subtitle: "Это фишинг или нет?",
                    submit_answer: "Ответить", correct_answer: "Правильно!", wrong_answer: "Неправильно!", next_question: "Следующий вопрос",
                    training_q1: "Вы получили письмо от 'banca-moldova@info.com' с просьбой подтвердить пароль. Ваши действия?",
                    training_q1_opt1: "Ввожу пароль", training_q1_opt2: "Удаляю письмо и сообщаю", training_q1_opt3: "Звоню в банк для проверки",
                    training_q2: "Появилось окно 'Вы выиграли iPhone! Жмите здесь!'. Ваши действия?",
                    training_q2_opt1: "Жму, чтобы забрать", training_q2_opt2: "Закрываю окно", training_q2_opt3: "Ввожу свои данные",
                    onboarding_title: "Инструктаж новых сотрудников", onboarding_subtitle: "Убедитесь, что каждый новый член команды прошел инструктаж.",
                    onboarding_invite: "Пригласить сотрудника", onboarding_employee: "Сотрудник", onboarding_status: "Статус", onboarding_date: "Дата завершения",
                    onboarding_status_completed: "Завершено", onboarding_status_pending: "Ожидание",
                    policy_generator_title: "Генератор политик", policy_generator_subtitle: "Создайте базовые документы безопасности.",
                    policy_generate_button: "Сгенерировать", policy_pass_title: "Политика паролей", policy_net_title: "Политика использования интернета", policy_incident_title: "План реагирования на инциденты",
                    incident_drill_title: "Симулятор инцидента", incident_drill_subtitle: "Проверьте готовность вашей команды.",
                    incident_drill_start_button: "Начать симуляцию", incident_drill_step: "Шаг", incident_drill_finish_button: "Завершить",
                    incident_drill_results_title: "Результаты симуляции",
                    drill_step1_title: "Обнаружение", drill_step1_q: "Вы получили подозрительное письмо. Что вы сделаете в первую очередь?",
                    drill_step1_opt1: "Изолирую компьютер и сообщу", drill_step1_opt2: "Удалю письмо",
                    drill_step2_title: "Сообщение", drill_step2_q: "Вы изолировали проблему. Кому вы сообщите об инциденте внутри компании?",
                    drill_step2_placeholder: "Имя сотрудника/отдела",
                    drill_continue_button: "Продолжить",
                    drill_results_text: "Симуляция завершена. Время реакции: 5 минут. Что улучшить: Уточнить внутренние контакты.",
                    drill_rerun_button: "Повторить симуляцию",
                },
                en: {
                    nav_dashboard: "Dashboard", nav_checklist: "Checklist", nav_reporting: "Reporting", nav_killer_features: "Killer Features",
                    nav_marketplace: "Marketplace", nav_risk_calculator: "Risk Calculator", nav_vendor_chain: "Vendor Chain", nav_industry_shield: "Industry Shield", nav_training: "Training",
                    nav_proactive_defense: "Proactive Defense", nav_onboarding: "Employee Onboarding", nav_policy_generator: "Policy Generator", nav_incident_drill: "Incident Drill",
                    dashboard_title: "Cyber Hygiene Dashboard", dashboard_subtitle: "Enter your domain or IP to perform a basic audit.", dashboard_scan_button: "Start Scan",
                    scan_results_for: "Audit Results for", compliance_score: "Compliance Score", key_findings: "Key Findings", scan_in_progress: "Scan in progress...",
                    passport_button: "Download Passport", passport_title: "Compliance Passport", passport_desc: "This is a model of the PDF report.",
                    dynamics_title: "Improvement Dynamics", status_good: "Good", status_medium: "Medium", status_weak: "Weak",
                    finding_recommendation: "Recommendation", find_expert_button: "Find Expert",
                    finding_tls_title: "TLS/SSL Policies", finding_tls_details: "TLS 1.2 & 1.3 active. Valid certificate.", finding_tls_rec: "Disable legacy TLS versions (1.0, 1.1).",
                    finding_email_auth_title: "Email Authentication (SPF, DKIM)", finding_email_auth_details: "SPF record found. DKIM record missing.", finding_email_auth_rec: "Configure DKIM to prevent spoofing.",
                    finding_headers_title: "Web Security Headers", finding_headers_details: "Content-Security-Policy missing.", finding_headers_rec: "Implement a strict CSP header.",
                    checklist_title: "Compliance Checklist (Art. 11)", checklist_subtitle: "Complete this questionnaire to assess compliance.", checklist_progress: "Compliance Progress",
                    checklist_section1_title: "Access Control", checklist_q1_text: 'Is multi-factor authentication (MFA) mandatory for administrative accounts?', checklist_q2_text: 'Are passwords complex and rotated periodically?',
                    checklist_section2_title: "Backup and Recovery", checklist_q3_text: 'Is there a backup plan for critical data?', checklist_q4_text: 'Has a restoration test been performed in the last 6 months?',
                    checklist_section3_title: "Logging and Monitoring", checklist_q5_text: 'Are security events centralized and monitored?',
                    reporting_title: "Incident Reporting (Art. 12)", reporting_subtitle: "Use this form to notify the authorities.",
                    initial_report: "Initial Notification", update_report: "Update", final_report: "Final Report",
                    report_details_for: "Details for", report_submit: "Submit Report",
                    smart_reporter_title: "Smart Reporter (AI)", smart_reporter_desc: "Describe the incident in your own words.", get_ai_help: "Get AI Help", ai_suggestion: "AI Suggestion",
                    incident_placeholder: "e.g., Our website was hacked...",
                    ai_suggestion_text: "A 'Web Defacement' type incident has been detected. It is recommended to isolate the server and analyze the logs.",
                    marketplace_title: "Cyber-Help Marketplace", marketplace_subtitle: "Find verified local experts.", contact_expert: "Contact Expert",
                    spec_web_sec: "Web Security", spec_backup: "Backup & Recovery", spec_net_sec: "Network Security", spec_email_sec: "Email Security",
                    risk_calculator_title: "Risk Calculator", risk_calculator_subtitle: "Turn abstract risks into financial estimates.",
                    calculate_risk: "Calculate Risk", potential_loss: "Estimated Annual Potential Loss", insurance_readiness: "Insurance Readiness Index",
                    industry: "Industry", employees: "Employees", turnover: "Turnover (MDL)",
                    industry_retail: "Retail", industry_it: "IT", industry_agri: "Agriculture", industry_const: "Construction",
                    vendor_chain_title: "Vendor Trust Chain", vendor_chain_subtitle: "Manage risks from your partners.",
                    invite_vendor: "Invite Vendor", vendor_name: "Vendor Name", vendor_status: "Status",
                    status_green: "Compliant", status_yellow: "Needs Attention", status_red: "High Risk",
                    industry_shield_title: "Industry Shield", industry_subtitle: "Get industry-specific security alerts.",
                    recent_alerts: "Recent Alerts", alert1_title: "New Phishing attack detected in the Agricultural sector", alert2_title: "Critical vulnerability in accounting software X",
                    alert_date_2h: "2 hours ago", alert_date_1d: "1 day ago",
                    training_title: "Weekly Cyber-Training", training_subtitle: "Test your knowledge. Is it phishing or not?",
                    submit_answer: "Submit Answer", correct_answer: "Correct!", wrong_answer: "Wrong!", next_question: "Next Question",
                    training_q1: "You received an email from 'banca-moldova@info.com' asking you to confirm your password. What do you do?",
                    training_q1_opt1: "Enter my password", training_q1_opt2: "Delete the email and report it", training_q1_opt3: "Call the bank to verify",
                    training_q2: "A pop-up appears saying 'You've won an iPhone! Click here!'. What do you do?",
                    training_q2_opt1: "Click to claim", training_q2_opt2: "Close the pop-up window", training_q2_opt3: "Enter my details",
                    onboarding_title: "Employee Onboarding", onboarding_subtitle: "Ensure every new team member gets basic training.",
                    onboarding_invite: "Invite Employee", onboarding_employee: "Employee", onboarding_status: "Status", onboarding_date: "Completion Date",
                    onboarding_status_completed: "Completed", onboarding_status_pending: "Pending",
                    policy_generator_title: "Policy Generator", policy_generator_subtitle: "Create basic security documents for your company.",
                    policy_generate_button: "Generate", policy_pass_title: "Password Policy", policy_net_title: "Internet Usage Policy", policy_incident_title: "Incident Response Plan",
                    incident_drill_title: "Incident Drill", incident_drill_subtitle: "Test your team's readiness with a simulation.",
                    incident_drill_start_button: "Start Drill", incident_drill_step: "Step", incident_drill_finish_button: "Finish Drill",
                    incident_drill_results_title: "Drill Results",
                    drill_step1_title: "Detection", drill_step1_q: "You received a suspicious email. What do you do first?",
                    drill_step1_opt1: "Isolate the machine and report", drill_step1_opt2: "Delete the email",
                    drill_step2_title: "Reporting", drill_step2_q: "You have isolated the problem. Where do you report the incident internally?",
                    drill_step2_placeholder: "Name of the person/department",
                    drill_continue_button: "Continue",
                    drill_results_text: "Drill complete. Response time: 5 minutes. Points to improve: Clarify internal contact.",
                    drill_rerun_button: "Rerun Drill",
                }
            };
            
            // --- APP STATE & COMMON VARIABLES ---
            let currentLang = localStorage.getItem('language') || 'ro';
            let complianceChart = null;
            const modal = document.getElementById('modal');
            
            // --- CORE APP LOGIC (Router, Language, Modal) ---

            const setLanguage = (lang) => {
                currentLang = lang;
                localStorage.setItem('language', lang);
                document.documentElement.lang = lang;
                
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.dataset.translate;
                    if (translations[lang] && translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                    const key = el.dataset.translatePlaceholder;
                    if (translations[lang] && translations[lang][key]) {
                        el.placeholder = translations[lang][key];
                    }
                });

                document.getElementById('lang-switcher').querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });
            };

            const router = () => {
                const hash = window.location.hash || '#dashboard';
                const pageId = hash.substring(1);

                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.toggle('active', section.id === pageId);
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.nav === pageId);
                });

                const pageTitleEl = document.getElementById('page-title');
                const titleKey = `nav_${pageId}`;
                pageTitleEl.textContent = (translations[currentLang] && translations[currentLang][titleKey]) || 'CyberCare';
                
                if (typeof pageInitializers[pageId] === 'function') {
                    pageInitializers[pageId]();
                }
            };

            const showModal = (titleKey, contentHTML) => {
                modal.querySelector('#modal-title').dataset.translate = titleKey;
                modal.querySelector('#modal-content').innerHTML = contentHTML;
                modal.classList.add('active');
                setLanguage(currentLang);
            };

            const hideModal = () => {
                modal.classList.remove('active');
            };

            // --- PAGE-SPECIFIC LOGIC & INITIALIZERS ---
            
            const pageInitializers = {
                dashboard: () => {
                    const startScanBtn = document.getElementById('start-scan-btn');
                    if (startScanBtn.dataset.listener) return;
                    startScanBtn.dataset.listener = 'true';
                    
                    startScanBtn.addEventListener('click', () => {
                        const scanTargetInput = document.getElementById('scan-target');
                        const loader = document.getElementById('loader-container');
                        const resultsContainer = document.getElementById('scan-results-container');
                        const target = scanTargetInput.value.trim() || 'exemplu.md';
                        resultsContainer.innerHTML = '';
                        loader.classList.remove('hidden');
                        
                        setTimeout(() => {
                            loader.classList.add('hidden');
                            displayScanResults(target, generateMockScanResults());
                        }, 1500);
                    });
                },
                
                checklist: () => {
                    const form = document.getElementById('compliance-form');
                    if (form.innerHTML.trim() !== '' && form.dataset.initialized) return;
                    form.innerHTML = '';
                    form.dataset.initialized = 'true';
                    
                    let totalQuestions = 0;
                    mockData.checklist.forEach(sectionData => {
                        const sectionEl = document.createElement('div');
                        const title = document.createElement('h4');
                        title.className = 'text-lg font-semibold mb-3 border-b pb-2';
                        title.dataset.translate = sectionData.sectionKey;
                        sectionEl.appendChild(title);
                        
                        sectionData.questions.forEach(q => {
                            totalQuestions++;
                            const questionEl = document.createElement('div');
                            questionEl.className = 'flex items-center justify-between p-3 rounded-md hover:bg-gray-50 transition-colors';
                            questionEl.innerHTML = `<label for="${q.id}" class="text-gray-700 flex-grow cursor-pointer" data-translate="${q.textKey}"></label><input type="checkbox" id="${q.id}" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">`;
                            sectionEl.appendChild(questionEl);
                        });
                        form.appendChild(sectionEl);
                    });

                    const updateProgress = () => {
                        const checkedCount = form.querySelectorAll('input:checked').length;
                        const percentage = totalQuestions > 0 ? Math.round((checkedCount / totalQuestions) * 100) : 0;
                        document.getElementById('checklist-progress-bar').style.width = `${percentage}%`;
                        document.getElementById('checklist-progress-text').textContent = `${percentage}%`;
                    };

                    form.addEventListener('change', updateProgress);
                    updateProgress();
                    setLanguage(currentLang);
                },
                
                reporting: () => {
                     const stagesContainer = document.getElementById('report-stages');
                     if (stagesContainer.innerHTML.trim() !== '' && stagesContainer.dataset.initialized) return;
                     stagesContainer.innerHTML = '';
                     stagesContainer.dataset.initialized = 'true';

                     const stages = ['initial', 'update', 'final'];
                     stages.forEach(stage => {
                         const button = document.createElement('button');
                         button.className = 'report-stage-btn py-3 px-1 sm:px-4 font-medium text-sm sm:text-base';
                         button.dataset.stage = stage;
                         button.dataset.translate = `${stage}_report`;
                         stagesContainer.appendChild(button);
                     });

                     const switchStage = (stage) => {
                        stagesContainer.querySelectorAll('button').forEach(btn => btn.classList.toggle('active', btn.dataset.stage === stage));
                        const form = document.getElementById('incident-report-form');
                        const stageText = (translations[currentLang] && translations[currentLang][`${stage}_report`]) || stage;
                        form.innerHTML = `<div class="space-y-4">
                                <div>
                                    <label class="font-medium">${(translations[currentLang].report_details_for || 'Details for')} ${stageText}</label>
                                    <textarea class="input-field mt-1" rows="5"></textarea>
                                </div>
                                <button class="btn btn-primary" data-translate="report_submit"></button>
                            </div>`;
                        setLanguage(currentLang);
                     };

                     stagesContainer.addEventListener('click', e => { if (e.target.dataset.stage) switchStage(e.target.dataset.stage) });

                     const aiHelperBtn = document.getElementById('ai-helper-btn');
                     if(!aiHelperBtn.dataset.listener){
                         aiHelperBtn.dataset.listener = 'true';
                         aiHelperBtn.addEventListener('click', () => {
                            const suggestionBox = document.getElementById('ai-suggestion-box');
                            const userInput = document.getElementById('ai-helper-input').value;
                            if(userInput.trim() === '') return;
                            suggestionBox.classList.remove('hidden');
                            suggestionBox.querySelector('p').dataset.translate = 'ai_suggestion_text';
                            setLanguage(currentLang);
                         });
                     }

                     switchStage('initial');
                },

                marketplace: () => {
                    const grid = document.getElementById('marketplace-grid');
                    if(grid.innerHTML.trim() !== '' && grid.dataset.initialized) return;
                    grid.innerHTML = '';
                    grid.dataset.initialized = 'true';

                    mockData.experts.forEach(expert => {
                        const card = document.createElement('div');
                        card.className = 'feature-card';
                        card.innerHTML = `
                            <h3 class="font-bold text-xl">${expert.name}</h3>
                            <p class="text-gray-500" data-translate="${expert.specKey}"></p>
                            <div class="flex items-center gap-1 text-yellow-500 my-2"><i class="fa-solid fa-star"></i> ${expert.rating}</div>
                            <button class="btn btn-primary w-full mt-3" data-translate="contact_expert"></button>
                        `;
                        grid.appendChild(card);
                    });
                    setLanguage(currentLang);
                },

                risk_calculator: () => {
                     const form = document.getElementById('risk-form');
                     if(form.dataset.listener) return;
                     form.dataset.listener = 'true';

                     const industrySelect = document.getElementById('industry-select');
                     if (industrySelect.options.length === 0) {
                         mockData.industries.forEach(ind => {
                             const option = document.createElement('option');
                             option.value = ind.name;
                             option.dataset.translate = ind.key;
                             industrySelect.appendChild(option);
                         });
                     }

                     form.addEventListener('submit', (e) => {
                         e.preventDefault();
                         const turnover = parseFloat(document.getElementById('turnover-input').value) || 0;
                         const employees = parseInt(document.getElementById('employees-input').value) || 0;
                         const loss = (turnover * 0.02) + (employees * 1500);
                         const readiness = Math.min(100, Math.round(60 + (turnover / 500000) - (employees / 10)));
                         
                         document.getElementById('risk-results').innerHTML = `
                            <div><p class="text-gray-600" data-translate="potential_loss"></p><p class="text-3xl font-bold text-red-600">${Math.round(loss).toLocaleString('ro-RO')} MDL</p></div>
                            <div class="mt-4"><p class="text-gray-600" data-translate="insurance_readiness"></p><p class="text-3xl font-bold text-green-600">${readiness}%</p></div>`;
                         document.getElementById('risk-results-container').classList.remove('hidden');
                         setLanguage(currentLang);
                     });
                     setLanguage(currentLang);
                },

                vendor_chain: () => {
                    const vendorList = document.getElementById('vendor-list');
                    if(vendorList.innerHTML.trim() !== '' && vendorList.dataset.initialized) return;
                    vendorList.innerHTML = '';
                    vendorList.dataset.initialized = 'true';
                    mockData.vendors.forEach(v => {
                         const row = document.createElement('tr');
                         row.className = 'border-b hover:bg-gray-50';
                         row.innerHTML = `<td class="p-3">${v.name}</td><td><span class="status-badge status-${v.status}" data-translate="status_${v.status}"></span></td>`;
                         vendorList.appendChild(row);
                    });
                    setLanguage(currentLang);
                },

                industry_shield: () => {
                    const container = document.getElementById('shield-alerts-container');
                    if(container.innerHTML.trim() !== '' && container.dataset.initialized) return;
                    container.innerHTML = '';
                    container.dataset.initialized = 'true';
                    mockData.alerts.forEach(a => {
                        const card = document.createElement('div');
                        card.className = 'alert-card';
                        card.innerHTML = `<p class="font-semibold" data-translate="${a.titleKey}"></p><p class="text-sm text-yellow-700" data-translate="${a.dateKey}"></p>`;
                        container.appendChild(card);
                    });
                    setLanguage(currentLang);
                },

                training: () => {
                     renderTrainingQuestion();
                },
                
                onboarding: () => {
                    const employeeList = document.getElementById('employee-list');
                    if(employeeList.innerHTML.trim() !== '' && employeeList.dataset.initialized) return;
                    employeeList.innerHTML = '';
                    employeeList.dataset.initialized = 'true';
                    mockData.employees.forEach(emp => {
                        const row = document.createElement('tr');
                        row.className = 'border-b hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="p-3">${emp.name}</td>
                            <td class="p-3"><span class="status-badge ${emp.status === 'completed' ? 'status-green' : 'status-yellow'}" data-translate="onboarding_status_${emp.status}"></span></td>
                            <td class="p-3">${emp.date}</td>`;
                        employeeList.appendChild(row);
                    });
                    setLanguage(currentLang);
                },

                policy_generator: () => {
                    const policyList = document.getElementById('policy-list');
                    if(policyList.innerHTML.trim() !== '' && policyList.dataset.initialized) return;
                    policyList.innerHTML = '';
                    policyList.dataset.initialized = 'true';
                    mockData.policies.forEach(pol => {
                        const card = document.createElement('div');
                        card.className = 'feature-card'; // Re-using feature-card style for consistency
                        card.innerHTML = `
                            <div class="text-center">
                                <i class="fa-solid ${pol.icon} fa-2x text-indigo-500 mb-4"></i>
                                <h3 class="font-bold text-lg" data-translate="${pol.titleKey}"></h3>
                                <button class="btn btn-secondary w-full mt-4" data-translate="policy_generate_button"></button>
                            </div>`;
                        policyList.appendChild(card);
                    });
                    setLanguage(currentLang);
                },

                incident_drill: () => {
                    const container = document.getElementById('drill-container');
                    
                    const renderDrillStep = (currentStep = 0) => {
                        if (currentStep >= mockData.drillSteps.length) {
                            renderDrillResults();
                            return;
                        }
                        const step = mockData.drillSteps[currentStep];
                        let contentHTML = `<div class="drill-step">
                            <h3 class="font-bold text-lg"><span data-translate="incident_drill_step"></span> ${currentStep + 1}: <span data-translate="${step.titleKey}"></span></h3>
                            <p class="mt-2" data-translate="${step.questionKey}"></p>`;
                        
                        if (step.optionsKeys) {
                            contentHTML += `<div class="mt-2 space-y-2">` + step.optionsKeys.map(key => `<button class="training-option" data-translate="${key}"></button>`).join('') + `</div>`;
                        }
                        if (step.inputPlaceholderKey) {
                            contentHTML += `<input type="text" class="input-field mt-2" data-translate-placeholder="${step.inputPlaceholderKey}">`;
                        }
                        
                        if(!step.optionsKeys){
                            contentHTML += `<button class="btn btn-primary mt-3" data-translate="drill_continue_button"></button>`;
                        }
                        contentHTML += `</div>`;
                        container.innerHTML = contentHTML;

                        const nextStepFn = () => renderDrillStep(currentStep + 1);
                        
                        container.querySelectorAll('button').forEach(btn => btn.addEventListener('click', nextStepFn));
                        setLanguage(currentLang);
                    };

                    const renderDrillResults = () => {
                         container.innerHTML = `<div class="text-center">
                            <h3 class="font-bold text-2xl text-green-600" data-translate="incident_drill_results_title"></h3>
                            <p class="mt-2" data-translate="drill_results_text"></p>
                            <button id="rerun-drill-btn" class="btn btn-secondary mt-4" data-translate="drill_rerun_button"></button>
                        </div>`;
                        document.getElementById('rerun-drill-btn').addEventListener('click', pageInitializers.incident_drill);
                        setLanguage(currentLang);
                    };

                    container.innerHTML = `<div class="text-center"><p class="text-lg mb-4" data-translate="incident_drill_subtitle"></p><button id="start-drill-btn" class="btn btn-primary" data-translate="incident_drill_start_button"></button></div>`;
                    document.getElementById('start-drill-btn').addEventListener('click', () => renderDrillStep(0));
                    setLanguage(currentLang);
                },
            };

            // --- HELPER FUNCTIONS ---
            
            function displayScanResults(target, results) {
                const resultsContainer = document.getElementById('scan-results-container');
                resultsContainer.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                        <h3 class="text-2xl font-bold"><span data-translate="scan_results_for"></span> <span class="text-indigo-600">${target}</span></h3>
                        <button id="passport-btn" class="btn btn-secondary w-full sm:w-auto"><i class="fa-solid fa-file-shield"></i><span data-translate="passport_button"></span></button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-1 feature-card flex flex-col items-center justify-center">
                            <h4 class="text-lg font-semibold mb-3" data-translate="compliance_score"></h4>
                            <div class="relative w-40 h-40"><canvas id="compliance-chart"></canvas><div id="compliance-score-text" class="absolute inset-0 flex items-center justify-center text-4xl font-bold"></div></div>
                            <p id="compliance-status-text" class="mt-3 text-xl font-bold"></p>
                        </div>
                        <div id="scan-details" class="md:col-span-2 feature-card space-y-4"></div>
                    </div>`;
                
                document.getElementById('passport-btn').addEventListener('click', () => {
                    const passportContent = `<p class="mb-4" data-translate="passport_desc"></p><div class="border rounded-lg p-4"><h4 class="font-bold text-lg" data-translate="dynamics_title"></h4><canvas id="dynamics-chart" height="150"></canvas></div>`;
                    showModal('passport_title', passportContent);
                    new Chart(document.getElementById('dynamics-chart').getContext('2d'), {
                        type: 'bar', data: { labels: ['Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'], datasets: [{ label: 'Score', data: [65, 68, 75, 72, 80, 85], backgroundColor: '#4f46e5' }] },
                        options: { scales: { y: { beginAtZero: true, max: 100 } } }
                    });
                });

                const scoreText = document.getElementById('compliance-score-text');
                const statusText = document.getElementById('compliance-status-text');
                const detailsContainer = document.getElementById('scan-details');
                
                scoreText.textContent = `${results.score}%`;
                let statusKey, color;
                if (results.score >= 85) { statusKey = 'status_good'; color = '#10b981'; }
                else if (results.score >= 60) { statusKey = 'status_medium'; color = '#f59e0b'; }
                else { statusKey = 'status_weak'; color = '#ef4444'; }
                scoreText.style.color = color;
                statusText.dataset.translate = statusKey;

                if (complianceChart) complianceChart.destroy();
                complianceChart = new Chart(document.getElementById('compliance-chart').getContext('2d'), { type: 'doughnut', data: { datasets: [{ data: [results.score, 100 - results.score], backgroundColor: [color, '#e5e7eb'], borderWidth: 0 }] }, options: { cutout: '75%', plugins: { legend: { display: false }, tooltip: { enabled: false } } } });

                results.findings.forEach(finding => {
                    const iconMap = { ok: 'fa-circle-check text-green-500', warn: 'fa-triangle-exclamation text-yellow-500', fail: 'fa-circle-xmark text-red-500' };
                    const el = document.createElement('div');
                    el.innerHTML = `
                        <div class="flex items-start gap-3"><i class="fa-solid ${iconMap[finding.status]} mt-1"></i>
                        <div><h5 class="font-semibold" data-translate="${finding.titleKey}"></h5><p class="text-sm text-gray-600" data-translate="${finding.detailsKey}"></p>
                        <p class="text-sm text-blue-600 mt-1"><i><strong data-translate="finding_recommendation"></strong>: <span data-translate="${finding.recommendationKey}"></span></i></p></div></div>`;
                    detailsContainer.appendChild(el);
                });
                setLanguage(currentLang);
            }
            
            function generateMockScanResults() {
                const score = Math.floor(Math.random() * 51) + 50;
                const findings = mockData.scanFindings.map(f => {
                    let status = f.status || (score > f.statusOkThreshold ? 'ok' : 'fail');
                    return { ...f, status };
                });
                return { score, findings };
            }
            
            function renderTrainingQuestion() {
                const trainingCard = document.getElementById('training-card');
                const q = mockData.trainingQuestions[Math.floor(Math.random() * mockData.trainingQuestions.length)];
                
                let optionsHTML = q.optionsKeys.map((optKey, index) => `<button class="training-option" data-index="${index}" data-translate="${optKey}"></button>`).join('');
                
                trainingCard.innerHTML = `
                    <h3 class="font-semibold text-lg mb-4" data-translate="${q.questionKey}"></h3>
                    <div class="space-y-2">${optionsHTML}</div>
                    <div id="training-feedback" class="mt-4"></div>`;

                trainingCard.querySelectorAll('.training-option').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const selectedIndex = parseInt(btn.dataset.index);
                        const feedbackEl = document.getElementById('training-feedback');
                        const resultKey = selectedIndex === q.correct ? 'correct_answer' : 'wrong_answer';
                        const resultClass = selectedIndex === q.correct ? 'correct' : 'wrong';
                        
                        feedbackEl.innerHTML = `<div class="training-result ${resultClass}" data-translate="${resultKey}"></div>
                                              <button id="next-q-btn" class="btn btn-primary w-full mt-3" data-translate="next_question"></button>`;
                        
                        document.getElementById('next-q-btn').addEventListener('click', renderTrainingQuestion);
                        setLanguage(currentLang);
                    });
                });
                setLanguage(currentLang);
            }

            // --- APP INITIALIZATION ---
            
            router();
            setLanguage(currentLang);

            window.addEventListener('hashchange', router);
            document.getElementById('lang-switcher').addEventListener('click', e => {
                if (e.target.matches('.lang-btn')) {
                    setLanguage(e.target.dataset.lang);
                    router(); // Re-run router to update page titles etc.
                }
            });
            modal.querySelector('#modal-close-btn').addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if(e.target === modal) hideModal();
            });

            // --- MOBILE MENU TOGGLE LOGIC ---
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            const toggleMenu = () => {
                sidebar.classList.toggle('is-open');
                overlay.classList.toggle('is-open');
            };

            menuToggleBtn.addEventListener('click', toggleMenu);
            overlay.addEventListener('click', toggleMenu);

            // Close sidebar when a nav link is clicked on mobile
            sidebar.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) { // Only affects mobile view
                        toggleMenu();
                    }
                });
            });
        });
    </script>
</body>
</html>
